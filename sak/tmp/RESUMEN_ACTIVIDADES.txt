========================================================================
IMPLEMENTACIÃ“N: PANEL DE ACTIVIDADES EN MENSAJE SHOW
========================================================================

âœ… BACKEND - Endpoint Creado
------------------------------------------------------------------------
Archivo: backend/app/routers/crm_mensaje_router.py

Endpoint: GET /crm/mensajes/{mensaje_id}/actividades

Funcionalidad:
- Obtiene todos los mensajes asociados a la oportunidad del mensaje
- Obtiene todos los eventos asociados a la oportunidad del mensaje
- Combina ambas listas en una Ãºnica lista de actividades
- Ordena cronolÃ³gicamente (mÃ¡s reciente primero)
- Retorna: mensaje_id, oportunidad_id, total, actividades[]

Estructura de respuesta:
{
  "mensaje_id": 23,
  "oportunidad_id": 6520,
  "total": 6,
  "actividades": [
    {
      "tipo": "mensaje",
      "id": 28,
      "fecha": "2025-11-29T11:34:00",
      "descripcion": "Respuesta #1: Gracias por...",
      "canal": "whatsapp",
      "estado": "enviado",
      "tipo_mensaje": "salida"
    },
    {
      "tipo": "evento",
      "id": 225,
      "fecha": "2025-11-29T11:34:00",
      "descripcion": "Llamada telefÃ³nica - Cliente...",
      "estado": "hecho",
      "tipo_id": 1,
      "motivo_id": 1
    }
  ]
}

âœ… FRONTEND - Panel de Actividades
------------------------------------------------------------------------
Archivo: frontend/src/app/resources/crm-mensajes/show.tsx

Cambios realizados:
1. Agregado estado para actividades: actividades, actividadesLoading
2. Agregada funciÃ³n loadActividades() que usa fetch para llamar endpoint
3. useEffect que carga actividades cuando cambia mensaje o oportunidad
4. Actualizado renderPanelContent() para mostrar lista de actividades
5. Agregados iconos: Mail, Phone, CheckCircle2, Clock

Funcionalidad del Panel:
- Muestra lista minimalista de actividades si hay oportunidad
- Cada actividad muestra:
  * Icono segÃºn tipo (mensaje/evento) y canal
  * Fecha formateada (hora si es hoy, fecha si es anterior)
  * DescripciÃ³n truncada
  * Estado del mensaje/evento
  * Colores diferenciados por tipo
- Scroll cuando hay muchas actividades (max-height: 400px)
- Mensaje por defecto cuando no hay oportunidad
- Se actualiza automÃ¡ticamente al crear oportunidad

VisualizaciÃ³n:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Historial de Actividades        6  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ“ 11:34  Evento                     â”‚
â”‚ Visita programada para el prÃ³xi...  â”‚
â”‚ pendiente                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ“ 11:34  Evento                     â”‚
â”‚ Llamada telefÃ³nica - Cliente int... â”‚
â”‚ hecho                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“± 11:34  Mensaje                   â”‚
â”‚ Respuesta #2: Gracias por tu int... â”‚
â”‚ enviado                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… PRUEBAS REALIZADAS
------------------------------------------------------------------------
1. test_actividades.py - Verifica endpoint bÃ¡sico
2. crear_actividades_prueba.py - Crea datos de prueba variados

Resultado: 6 actividades creadas para mensaje #23
- 3 mensajes (1 entrada, 2 salidas)
- 3 eventos (2 hechos, 1 pendiente)

URL de prueba:
http://localhost:3000/admin/crm-mensajes/23/show

âœ… FLUJO DE DATOS
------------------------------------------------------------------------
1. Usuario abre vista de mensaje (show.tsx)
2. useEffect detecta mensaje.id y mensaje.oportunidad_id
3. Si hay oportunidad â†’ loadActividades()
4. fetch() â†’ GET /crm/mensajes/{id}/actividades
5. Backend consulta mensajes y eventos de la oportunidad
6. Backend combina, ordena y retorna lista
7. Frontend actualiza estado actividades[]
8. renderPanelContent() muestra lista visual
9. Al crear oportunidad â†’ refresh() + loadActividades()

âœ… CARACTERÃSTICAS IMPLEMENTADAS
------------------------------------------------------------------------
âœ“ Lista minimalista con iconos diferenciados
âœ“ Colores por tipo de actividad
âœ“ Ordenamiento cronolÃ³gico inverso
âœ“ Formato de fecha inteligente (hoy/fecha)
âœ“ DescripciÃ³n truncada para mantener UI limpia
âœ“ Scroll para listas largas
âœ“ Recarga automÃ¡tica al crear oportunidad
âœ“ Manejo de estados de carga
âœ“ Manejo de errores
âœ“ Mensaje contextual cuando no hay oportunidad

========================================================================
